<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Download torrents via magnet links directly in your browser">
    <meta name="theme-color" content="#6366f1">
    <title>Torrent Downloader</title>
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-magnet"></i>
                <h1>Torrent Downloader</h1>
            </div>
            <p class="tagline">Download torrents directly to your browser</p>
        </header>

        <!-- Add Magnet Link Section -->
        <section class="add-torrent" aria-label="Add new torrent">
            <form id="magnetForm" class="input-group" onsubmit="return false;">
                <label for="magnetInput" class="visually-hidden">Magnet Link</label>
                <i class="fas fa-link" aria-hidden="true"></i>
                <input type="text" id="magnetInput" placeholder="Paste magnet link here..." autocomplete="off"
                    aria-describedby="errorMessage" spellcheck="false">
                <button id="addButton" type="submit" class="btn btn-primary">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    <span>Add Torrent</span>
                </button>
            </form>
            <div id="errorMessage" class="error-message" role="alert" aria-live="polite"></div>
        </section>

        <!-- Tabs -->
        <nav class="tabs" role="tablist" aria-label="Content sections">
            <button class="tab active" data-tab="downloads" role="tab" aria-selected="true"
                aria-controls="downloadsTab">
                <i class="fas fa-cloud-download-alt" aria-hidden="true"></i>
                Active Downloads
                <span class="badge" id="downloadCount" aria-label="Download count">0</span>
            </button>
            <button class="tab" data-tab="files" role="tab" aria-selected="false" aria-controls="filesTab">
                <i class="fas fa-folder-open" aria-hidden="true"></i>
                My Files
                <span class="badge" id="fileCount" aria-label="File count">0</span>
            </button>
        </nav>

        <!-- Downloads Tab -->
        <section id="downloadsTab" class="tab-content active" role="tabpanel" aria-labelledby="downloads-tab">
            <div id="downloadsList" class="downloads-list" aria-live="polite">
                <div class="empty-state">
                    <i class="fas fa-cloud-download-alt" aria-hidden="true"></i>
                    <h3>No active downloads</h3>
                    <p>Paste a magnet link above to start downloading</p>
                </div>
            </div>
        </section>

        <!-- Files Tab -->
        <section id="filesTab" class="tab-content" role="tabpanel" aria-labelledby="files-tab">
            <div class="files-header">
                <button id="refreshFiles" class="btn btn-secondary" aria-label="Refresh file list">
                    <i class="fas fa-sync-alt" aria-hidden="true"></i>
                    Refresh
                </button>
            </div>
            <div id="filesList" class="files-list" aria-live="polite">
                <div class="empty-state">
                    <i class="fas fa-folder-open" aria-hidden="true"></i>
                    <h3>No files yet</h3>
                    <p>Completed downloads will appear here</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container" role="status" aria-live="polite"></div>

    <!-- Video Player Modal -->
    <div id="playerModal" class="modal" role="dialog" aria-labelledby="playerTitle" aria-hidden="true">
        <div class="modal-overlay" onclick="closePlayer()"></div>
        <div class="modal-content player-modal">
            <div class="modal-header">
                <h2 id="playerTitle" class="modal-title">
                    <i class="fas fa-play-circle" aria-hidden="true"></i>
                    <span id="playerFileName">Now Playing</span>
                </h2>
                <div class="modal-header-actions">
                    <button class="btn btn-secondary btn-sm" onclick="openSubtitlePicker()" title="Add Subtitles">
                        <i class="fas fa-closed-captioning"></i>
                        <span class="btn-text">Subtitles</span>
                    </button>
                    <button class="modal-close" onclick="closePlayer()" aria-label="Close player">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="player-container">
                <video id="videoPlayer" crossorigin="anonymous" preload="metadata" playsinline>
                    Your browser does not support video playback.
                </video>
            </div>
            <div class="player-controls">
                <div class="player-info">
                    <span id="playerFileSize"></span>
                    <span id="playerFormat"></span>
                </div>
                <div class="player-actions">
                    <a id="playerDownloadBtn" href="#" class="btn btn-success btn-sm" download>
                        <i class="fas fa-download"></i>
                        Download
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Subtitle Upload Modal -->
    <div id="subtitleModal" class="modal subtitle-modal" role="dialog" aria-labelledby="subtitleTitle"
        aria-hidden="true">
        <div class="modal-overlay" onclick="closeSubtitleModal()"></div>
        <div class="modal-content subtitle-modal-content">
            <div class="modal-header">
                <h2 id="subtitleTitle" class="modal-title">
                    <i class="fas fa-closed-captioning" aria-hidden="true"></i>
                    Add Subtitles
                </h2>
                <button class="modal-close" onclick="closeSubtitleModal()" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="subtitle-content">
                <div class="subtitle-upload-zone" id="subtitleDropZone">
                    <i class="fas fa-file-alt"></i>
                    <p>Drag & drop subtitle file here</p>
                    <span>or</span>
                    <label class="btn btn-primary btn-sm">
                        <i class="fas fa-folder-open"></i>
                        Browse Files
                        <input type="file" id="subtitleFileInput" accept=".vtt,.srt,.ass,.ssa" hidden>
                    </label>
                    <p class="subtitle-formats">Supports: VTT, SRT, ASS, SSA</p>
                </div>
                <div id="subtitleList" class="subtitle-list">
                    <!-- Loaded subtitles will appear here -->
                </div>
                <div class="subtitle-url-section">
                    <p>Or load from torrent files:</p>
                    <select id="torrentSubtitleSelect" class="subtitle-select">
                        <option value="">Select subtitle from downloads...</option>
                    </select>
                    <button class="btn btn-primary btn-sm" onclick="loadSelectedSubtitle()">
                        <i class="fas fa-plus"></i>
                        Add
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for subtitles -->
    <input type="file" id="hiddenSubtitleInput" accept=".vtt,.srt,.ass,.ssa" hidden>

    <script src="/socket.io/socket.io.js"></script>
    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script src="script.js"></script>
</body>

</html>